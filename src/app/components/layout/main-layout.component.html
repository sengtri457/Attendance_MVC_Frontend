<div class="layout-wrapper" [class.sidebar-collapsed]="isSidebarCollapsed">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <i class="bi bi-clock-history logo-icon"></i>
                <span class="logo-text">Attendance</span>
            </div>
            <!-- Mobile: close overlay. Desktop: collapse sidebar -->
            <button class="btn-toggle d-md-none" (click)="toggleSidebar()" title="Close menu">
                <i class="bi bi-x-lg"></i>
            </button>
            <button class="btn-collapse-sidebar d-none d-md-flex" (click)="toggleSidebar()"
                [title]="isSidebarCollapsed ? 'Expand sidebar' : 'Collapse sidebar'">
                <i class="bi"
                    [ngClass]="isSidebarCollapsed ? 'bi-layout-sidebar-inset' : 'bi-layout-sidebar-inset-reverse'"></i>
            </button>
        </div>

        <!-- Navigation -->
        <nav class="sidebar-nav">
            <ul>
                <li *ngFor="let item of navItems">
                    <!-- Check roles if needed -->
                    <ng-container *ngIf="hasRole(item.roles)">
                        <a [routerLink]="item.route" routerLinkActive="active"
                            [routerLinkActiveOptions]="{exact: item.route === '/dashboard'}" class="nav-item"
                            [title]="isSidebarCollapsed ? (item.label | translate) : null">
                            <i class="bi" [ngClass]="item.icon"></i>
                            <span class="nav-label">{{ item.label | translate }}</span>
                        </a>
                    </ng-container>
                </li>
            </ul>
        </nav>

        <!-- Footer Profile -->
        <div class="sidebar-footer">
            <div class="user-profile-compact">
                <div class="avatar-circle"
                    [title]="(currentUser.username || 'Admin') + ' – ' + (currentUser.role || '')">
                    <i class="bi bi-person-fill"></i>
                </div>
                <div class="user-info">
                    <span class="user-name text-truncate" style="max-width: 120px;"
                        [title]="currentUser.username || 'Admin'">
                        {{ (currentUser.username || 'Admin') | titlecase }}
                    </span>
                    <span class="user-role">{{ currentUser.role | titlecase }}</span>
                </div>
            </div>
            <button class="btn-logout-icon" (click)="logout()" [title]="'LOGOUT' | translate">
                <i class="bi bi-box-arrow-right"></i>
            </button>
        </div>
    </aside>

    <!-- Main Content Column -->
    <main class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="btn-toggle-sidebar" (click)="toggleSidebar()">
                    <i class="bi bi-list"></i>
                </button>
                <h4 class="page-title d-none d-sm-block">{{ 'ATTENDANCE_SYSTEM' | translate }}</h4>
            </div>

            <div class="topbar-right">
                <!-- Language Toggle -->
                <button class="btn-clean" (click)="languageService.toggleLanguage()" title="Switch Language">
                    <i class="bi bi-translate me-1"></i>
                    {{ languageService.currentLang() === 'en' ? 'ខ្មែរ' : 'English' }}
                </button>

                <button class="icon-btn" title="Notifications">
                    <div class="badge-dot"></div>
                    <i class="bi bi-bell"></i>
                </button>
                <button class="icon-btn" title="Apps">
                    <i class="bi bi-grid"></i>
                </button>

                <div class="user-dropdown">
                    <div class="user-pill">
                        <img src="assets/admin-avatar.png"
                            onerror="this.src='https://ui-avatars.com/api/?name=Admin&background=random'" alt="User"
                            class="user-avatar">
                        <span
                            class="d-none d-md-inline fw-medium text-dark small">{{ currentUser.username || 'Admin' }}</span>
                        <i class="bi bi-chevron-down ms-1 text-muted" style="font-size: 0.7rem;"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Router Content -->
        <div class="content-wrapper">
            <router-outlet></router-outlet>
        </div>
    </main>
</div>